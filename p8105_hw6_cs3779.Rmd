---
title: "p8105_hw6_cs3779"
author: "CJ Snyder"
date: "11/19/2019"
output: github_document
---

```{r, include = FALSE}
library(tidyverse)
library(knitr)
library(readxl)
library(viridis)
library(patchwork)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

# **Problem 1**
## **Data Tidying**
```{r}
bw_df = 
  read_csv("./data/birthweight.csv",
           col_types = "fdddddfdfdddfddddddd") %>% 
  janitor::clean_names() %>% 
  mutate(
    babysex = factor(babysex, levels=c(1,2), labels=c("male", "female")),
    frace = factor(frace, levels=c(1,2,3,4,8,9), labels = c("white", "black", "asian", "puerto rican", "other", "unknown")),
    malform = factor(malform, levels=c(0,1), labels=c("absent", "present")),
    mrace = factor(mrace, levels=c(1,2,3,4,8), labels = c("white", "black", "asian", "puerto rican", "other")),
    ppbmi = round(ppbmi, digits = 2),
    delbmi = round(703 * delwt / (mheight)^2, digits = 2)
  )

colSums(is.na(bw_df))
```
Notes: No missing values for any of the columns.

## **Model Building**
```{r}
linearmod = lm(bwt ~ babysex + delbmi + gaweeks + fincome + momage + ppbmi + smoken, data = bw_df)

linearmod %>% 
  broom::tidy() %>% 
  kable(digits = 3)

linearmod_frace = lm(bwt ~ babysex + delbmi + gaweeks + fincome + momage + ppbmi + smoken + frace, data = bw_df)

linearmod_mrace = lm(bwt ~ babysex + delbmi + gaweeks + fincome + momage + ppbmi + smoken + mrace, data = bw_df)

anova(linearmod, linearmod_frace) %>% 
  broom::tidy()

anova(linearmod, linearmod_mrace) %>% 
  broom::tidy()

linearmod_frace %>% 
  broom::tidy() %>% 
  kable(digits = 3)

linearmod_final = lm(bwt ~ babysex + delbmi + gaweeks + ppbmi + smoken + frace, data = bw_df)

linearmod_final %>% 
  broom::tidy() %>% 
  mutate(term = str_replace(term, "^frace", "Father's Race: ")) %>% 
  kable(digits = 3)
```
Notes: I started with covariates that wouldn't be too colinear with birthweight like birth length or head circumfrance (i.e. where a higher value in one automatically determines a higher value in the other without a clear causal direction). I then went through each variable adding it to the model to test if that variable and the other variables were/remained significant. If so, I kept them in the model. I conducted partial F-tests to determine if categorical variables were significant. _frace_ was significant compared to _mrace_, but after including it in the model, _momage_ and _fincome_ became insignificant, so I removed them from the final model. I tried to be as parsimonious as well by including BMIs instead of both height and weight (pre-pregnancy and delivery).

## **Model Diagnostics**
```{r}
bw_df %>% 
  modelr::add_residuals(linearmod_final)
  
```






